<!-- ---
import { baseUrl } from '@/utils/functions';
const logo = baseUrl('/assets/css-logo.svg');
---

<section class="am-hero">
  <h1>
    20 PROJECTS WITH CSS <img src={logo} alt='Logo' />
  </h1>
</section>
<style>
  .am-hero {
    height: 100vh;
    position: relative;
  }

  h1 {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 5vmax;
    text-align: center;
    text-wrap: balance;
    color: transparent;
    background-image: var(--gradient);
    background-clip: text;

    img {
      width: 4vmax;
      transform: translateY(0.3vmax);
    }
  }
</style>
 -->
<canvas id='c'></canvas>

<style>
  canvas {
    width: 100%;
    position: relative;
    height: 100vh;
    z-index: 5;
  }
</style>

<script>
  import { TITLE } from '@/utils/data';
  const canvas = document.getElementById('c') as HTMLCanvasElement;
  const ctx = canvas.getContext('2d') as CanvasRenderingContext2D;

  const text: string = TITLE;

  const palette: string[] = [
    '#6a8caf', // Azul acero suave
    '#8fbcd4', // Azul cielo pastel
    '#a7d8c9', // Verde menta claro
    '#cbe4b4', // Verde lima pastel
    '#f2e5a2', // Amarillo mantequilla
    '#e8b58a', // Durazno / melocot√≥n suave
    '#d97a7a' // Coral rosado
  ];

  interface Pointer {
    x: number;
    y: number;
  }

  const pointer: Pointer = { x: -9999, y: -9999 };

  let w: number;
  let h: number;
  let raf: number;

  const particles: Particle[] = [];

  class Particle {
    ox: number;
    oy: number;
    x: number;
    y: number;
    vx: number;
    vy: number;
    r: number;
    color: string;

    constructor(x: number, y: number, color: string) {
      this.ox = x;
      this.oy = y;
      this.x = x;
      this.y = y;
      this.vx = 0;
      this.vy = 0;
      this.r = 1.2;
      this.color = color;
    }

    update(): void {
      const dx = this.x - pointer.x;
      const dy = this.y - pointer.y;
      const d = Math.hypot(dx, dy);

      if (d < 120 && d !== 0) {
        const f = (1 - d / 120) * 6;
        this.vx += (dx / d) * f;
        this.vy += (dy / d) * f;
      }

      this.vx += (this.ox - this.x) * 0.02;
      this.vy += (this.oy - this.y) * 0.02;

      this.vx *= 0.85;
      this.vy *= 0.85;

      this.x += this.vx;
      this.y += this.vy;
    }

    draw(): void {
      ctx.fillStyle = this.color;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
      ctx.fill();
    }
  }

  function createText(): void {
    ctx.clearRect(0, 0, w, h);
    ctx.font = `900 ${w / text.length + 15}px system-ui`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';

    const gradient = ctx.createLinearGradient(0, 0, w, h);
    palette.forEach((c, i) => gradient.addColorStop(i / (palette.length - 1), c));

    ctx.fillStyle = gradient;
    ctx.fillText(text, w / 2, h / 2);

    const data = ctx.getImageData(0, 0, w, h).data;
    particles.length = 0;

    for (let y = 0; y < h; y += 3) {
      for (let x = 0; x < w; x += 3) {
        const i = (y * w + x) * 4;
        if (data[i + 3] > 0) {
          const c = `rgb(${data[i]},${data[i + 1]},${data[i + 2]})`;
          particles.push(new Particle(x, y, c));
        }
      }
    }

    ctx.clearRect(0, 0, w, h);
  }

  function animate(): void {
    ctx.clearRect(0, 0, w, h);
    for (const p of particles) {
      p.update();
      p.draw();
    }
    raf = requestAnimationFrame(animate);
  }

  function resize(): void {
    cancelAnimationFrame(raf);
    w = canvas.width = canvas.clientWidth;
    h = canvas.height = canvas.clientHeight;
    createText();
    animate();
  }

  window.addEventListener('resize', resize);
  window.addEventListener('pointermove', (e: PointerEvent) => {
    pointer.x = e.clientX;
    pointer.y = e.clientY;
  });

  resize();
</script>
