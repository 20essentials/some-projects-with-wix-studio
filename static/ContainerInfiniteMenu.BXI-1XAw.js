import{j as b}from"./jsx-runtime.D_zvdyIk.js";import{a as Y}from"./index.fSmatsIe.js";import{a as rt}from"./data.CNuOkarp.js";function nt(t){return new URL(t.replace(/^\/+/,""),"https://20essentials.github.io/some-projects-with-wix-studio").toString()}var st=1e-6,M=typeof Float32Array<"u"?Float32Array:Array;function at(){var t=new M(9);return M!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function _(){var t=new M(16);return M!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function ot(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ct(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function H(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],o=e[5],c=e[6],h=e[7],l=e[8],f=e[9],d=e[10],m=e[11],v=e[12],u=e[13],x=e[14],T=e[15],I=i*o-r*a,A=i*c-n*a,p=i*h-s*a,P=r*c-n*o,R=r*h-s*o,U=n*h-s*c,z=l*u-f*v,V=l*x-d*v,N=l*T-m*v,L=f*x-d*u,C=f*T-m*u,B=d*T-m*x,E=I*B-A*C+p*L+P*N-R*V+U*z;return E?(E=1/E,t[0]=(o*B-c*C+h*L)*E,t[1]=(n*C-r*B-s*L)*E,t[2]=(u*U-x*R+T*P)*E,t[3]=(d*R-f*U-m*P)*E,t[4]=(c*N-a*B-h*V)*E,t[5]=(i*B-n*N+s*V)*E,t[6]=(x*p-v*U-T*A)*E,t[7]=(l*U-d*p+m*A)*E,t[8]=(a*C-o*N+h*z)*E,t[9]=(r*N-i*C-s*z)*E,t[10]=(v*R-u*p+T*I)*E,t[11]=(f*p-l*R-m*I)*E,t[12]=(o*V-a*L-c*z)*E,t[13]=(i*L-r*V+n*z)*E,t[14]=(u*A-v*P-x*I)*E,t[15]=(l*P-f*A+d*I)*E,t):null}function G(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],o=e[4],c=e[5],h=e[6],l=e[7],f=e[8],d=e[9],m=e[10],v=e[11],u=e[12],x=e[13],T=e[14],I=e[15],A=i[0],p=i[1],P=i[2],R=i[3];return t[0]=A*r+p*o+P*f+R*u,t[1]=A*n+p*c+P*d+R*x,t[2]=A*s+p*h+P*m+R*T,t[3]=A*a+p*l+P*v+R*I,A=i[4],p=i[5],P=i[6],R=i[7],t[4]=A*r+p*o+P*f+R*u,t[5]=A*n+p*c+P*d+R*x,t[6]=A*s+p*h+P*m+R*T,t[7]=A*a+p*l+P*v+R*I,A=i[8],p=i[9],P=i[10],R=i[11],t[8]=A*r+p*o+P*f+R*u,t[9]=A*n+p*c+P*d+R*x,t[10]=A*s+p*h+P*m+R*T,t[11]=A*a+p*l+P*v+R*I,A=i[12],p=i[13],P=i[14],R=i[15],t[12]=A*r+p*o+P*f+R*u,t[13]=A*n+p*c+P*d+R*x,t[14]=A*s+p*h+P*m+R*T,t[15]=A*a+p*l+P*v+R*I,t}function Q(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function ht(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function lt(t,e,i,r,n){var s=1/Math.tan(e/2);if(t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0){var a=1/(r-n);t[10]=(n+r)*a,t[14]=2*n*r*a}else t[10]=-1,t[14]=-2*r;return t}var ft=lt;function K(t,e,i,r){var n=e[0],s=e[1],a=e[2],o=r[0],c=r[1],h=r[2],l=n-i[0],f=s-i[1],d=a-i[2],m=l*l+f*f+d*d;m>0&&(m=1/Math.sqrt(m),l*=m,f*=m,d*=m);var v=c*d-h*f,u=h*l-o*d,x=o*f-c*l;return m=v*v+u*u+x*x,m>0&&(m=1/Math.sqrt(m),v*=m,u*=m,x*=m),t[0]=v,t[1]=u,t[2]=x,t[3]=0,t[4]=f*x-d*u,t[5]=d*v-l*x,t[6]=l*u-f*v,t[7]=0,t[8]=l,t[9]=f,t[10]=d,t[11]=0,t[12]=n,t[13]=s,t[14]=a,t[15]=1,t}function g(){var t=new M(3);return M!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function dt(t){var e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function w(t,e,i){var r=new M(3);return r[0]=t,r[1]=e,r[2]=i,r}function mt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function vt(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function ut(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function F(t,e){var i=e[0],r=e[1],n=e[2],s=i*i+r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function k(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function W(t,e,i){var r=e[0],n=e[1],s=e[2],a=i[0],o=i[1],c=i[2];return t[0]=n*c-s*o,t[1]=s*a-r*c,t[2]=r*o-n*a,t}function X(t,e,i){var r=i[0],n=i[1],s=i[2],a=i[3],o=e[0],c=e[1],h=e[2],l=n*h-s*c,f=s*o-r*h,d=r*c-n*o;return l=l+l,f=f+f,d=d+d,t[0]=o+a*l+n*d-s*f,t[1]=c+a*f+s*l-r*d,t[2]=h+a*d+r*f-n*l,t}var xt=dt;(function(){var t=g();return function(e,i,r,n,s,a){var o,c;for(i||(i=3),r||(r=0),n?c=Math.min(n*i+r,e.length):c=e.length,o=r;o<c;o+=i)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],s(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}})();function At(){var t=new M(4);return M!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function pt(t,e){var i=e[0],r=e[1],n=e[2],s=e[3],a=i*i+r*r+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),t[0]=i*a,t[1]=r*a,t[2]=n*a,t[3]=s*a,t}(function(){var t=At();return function(e,i,r,n,s,a){var o,c;for(i||(i=4),r||(r=0),n?c=Math.min(n*i+r,e.length):c=e.length,o=r;o<c;o+=i)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],s(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}})();function y(){var t=new M(4);return M!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function et(t,e,i){i=i*.5;var r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function Z(t,e,i){var r=e[0],n=e[1],s=e[2],a=e[3],o=i[0],c=i[1],h=i[2],l=i[3];return t[0]=r*l+a*o+n*h-s*c,t[1]=n*l+a*c+s*o-r*h,t[2]=s*l+a*h+r*c-n*o,t[3]=a*l-r*o-n*c-s*h,t}function D(t,e,i,r){var n=e[0],s=e[1],a=e[2],o=e[3],c=i[0],h=i[1],l=i[2],f=i[3],d,m,v,u,x;return m=n*c+s*h+a*l+o*f,m<0&&(m=-m,c=-c,h=-h,l=-l,f=-f),1-m>st?(d=Math.acos(m),v=Math.sin(d),u=Math.sin((1-r)*d)/v,x=Math.sin(r*d)/v):(u=1-r,x=r),t[0]=u*n+x*c,t[1]=u*s+x*h,t[2]=u*a+x*l,t[3]=u*o+x*f,t}function Pt(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Rt(t,e){var i=e[0]+e[4]+e[8],r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[n*3+n]&&(n=2);var s=(n+1)%3,a=(n+2)%3;r=Math.sqrt(e[n*3+n]-e[s*3+s]-e[a*3+a]+1),t[n]=.5*r,r=.5/r,t[3]=(e[s*3+a]-e[a*3+s])*r,t[s]=(e[s*3+n]+e[n*3+s])*r,t[a]=(e[a*3+n]+e[n*3+a])*r}return t}var q=pt;(function(){var t=g(),e=w(1,0,0),i=w(0,1,0);return function(r,n,s){var a=k(n,s);return a<-.999999?(W(t,e,n),xt(t)<1e-6&&W(t,i,n),F(t,t),et(r,t,Math.PI),r):a>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(W(t,n,s),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+a,q(r,r))}})();(function(){var t=y(),e=y();return function(i,r,n,s,a,o){return D(t,r,a,o),D(e,n,s,o),D(i,t,e,2*o*(1-o)),i}})();(function(){var t=at();return function(e,i,r,n){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-i[0],t[5]=-i[1],t[8]=-i[2],q(e,Rt(e,t))}})();function S(){var t=new M(2);return M!=Float32Array&&(t[0]=0,t[1]=0),t}function Et(t){var e=new M(2);return e[0]=t[0],e[1]=t[1],e}function j(t,e){var i=new M(2);return i[0]=t,i[1]=e,i}function J(t,e){return t[0]=e[0],t[1]=e[1],t}function $(t,e,i){return t[0]=e,t[1]=i,t}function Tt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function Mt(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function It(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function gt(t){var e=t[0],i=t[1];return e*e+i*i}var _t=Mt,yt=gt;(function(){var t=S();return function(e,i,r,n,s,a){var o,c;for(i||(i=2),r||(r=0),n?c=Math.min(n*i+r,e.length):c=e.length,o=r;o<c;o+=i)t[0]=e[o],t[1]=e[o+1],s(t,t,a),e[o]=t[0],e[o+1]=t[1];return e}})();const bt=`#version 300 es

uniform mat4 uWorldMatrix;
uniform mat4 uViewMatrix;
uniform mat4 uProjectionMatrix;
uniform vec3 uCameraPosition;
uniform vec4 uRotationAxisVelocity;

in vec3 aModelPosition;
in vec3 aModelNormal;
in vec2 aModelUvs;
in mat4 aInstanceMatrix;

out vec2 vUvs;
out float vAlpha;
flat out int vInstanceId;

#define PI 3.141593

void main() {
    vec4 worldPosition = uWorldMatrix * aInstanceMatrix * vec4(aModelPosition, 1.);

    vec3 centerPos = (uWorldMatrix * aInstanceMatrix * vec4(0., 0., 0., 1.)).xyz;
    float radius = length(centerPos.xyz);

    if (gl_VertexID > 0) {
        vec3 rotationAxis = uRotationAxisVelocity.xyz;
        float rotationVelocity = min(.15, uRotationAxisVelocity.w * 15.);
        vec3 stretchDir = normalize(cross(centerPos, rotationAxis));
        vec3 relativeVertexPos = normalize(worldPosition.xyz - centerPos);
        float strength = dot(stretchDir, relativeVertexPos);
        float invAbsStrength = min(0., abs(strength) - 1.);
        strength = rotationVelocity * sign(strength) * abs(invAbsStrength * invAbsStrength * invAbsStrength + 1.);
        worldPosition.xyz += stretchDir * strength;
    }

    

    gl_Position = uProjectionMatrix * uViewMatrix * worldPosition;

    vAlpha = smoothstep(0.5, 1., normalize(worldPosition.xyz).z) * .9 + .1;
    vUvs = aModelUvs;
    vInstanceId = gl_InstanceID;
}
`,wt=`#version 300 es
precision highp float;

uniform sampler2D uTex;
uniform int uItemCount;
uniform int uAtlasSize;

out vec4 outColor;

in vec2 vUvs;
in float vAlpha;
flat in int vInstanceId;

void main() {
    int itemIndex = vInstanceId % uItemCount;
    int cellsPerRow = uAtlasSize;
    int cellX = itemIndex % cellsPerRow;
    int cellY = itemIndex / cellsPerRow;
    vec2 cellSize = vec2(1.0) / vec2(float(cellsPerRow));
    vec2 cellOffset = vec2(float(cellX), float(cellY)) * cellSize;

    ivec2 texSize = textureSize(uTex, 0);
    float imageAspect = float(texSize.x) / float(texSize.y);
    float containerAspect = 1.0;
    
    float scale = max(imageAspect / containerAspect, 
                     containerAspect / imageAspect);
    
    vec2 st = vec2(vUvs.x, 1.0 - vUvs.y);
    st = (st - 0.5) * scale + 0.5;
    
    st = clamp(st, 0.0, 1.0);
    st = st * cellSize + cellOffset;
    
    outColor = texture(uTex, st);
    outColor.a *= vAlpha;
}
`;class O{a;b;c;constructor(e,i,r){this.a=e,this.b=i,this.c=r}}class St{position;normal;uv;constructor(e,i,r){this.position=w(e,i,r),this.normal=g(),this.uv=S()}}class it{vertices;faces;constructor(){this.vertices=[],this.faces=[]}addVertex(...e){for(let i=0;i<e.length;i+=3)this.vertices.push(new St(e[i],e[i+1],e[i+2]));return this}addFace(...e){for(let i=0;i<e.length;i+=3)this.faces.push(new O(e[i],e[i+1],e[i+2]));return this}get lastVertex(){return this.vertices[this.vertices.length-1]}subdivide(e=1){const i={};let r=this.faces;for(let n=0;n<e;++n){const s=new Array(r.length*4);r.forEach((a,o)=>{const c=this.getMidPoint(a.a,a.b,i),h=this.getMidPoint(a.b,a.c,i),l=this.getMidPoint(a.c,a.a,i),f=o*4;s[f+0]=new O(a.a,c,l),s[f+1]=new O(a.b,h,c),s[f+2]=new O(a.c,l,h),s[f+3]=new O(c,h,l)}),r=s}return this.faces=r,this}spherize(e=1){return this.vertices.forEach(i=>{F(i.normal,i.position),mt(i.position,i.normal,e)}),this}get data(){return{vertices:this.vertexData,indices:this.indexData,normals:this.normalData,uvs:this.uvData}}get vertexData(){return new Float32Array(this.vertices.flatMap(e=>Array.from(e.position)))}get normalData(){return new Float32Array(this.vertices.flatMap(e=>Array.from(e.normal)))}get uvData(){return new Float32Array(this.vertices.flatMap(e=>Array.from(e.uv)))}get indexData(){return new Uint16Array(this.faces.flatMap(e=>[e.a,e.b,e.c]))}getMidPoint(e,i,r){const n=e<i?`k_${i}_${e}`:`k_${e}_${i}`;if(Object.prototype.hasOwnProperty.call(r,n))return r[n];const s=this.vertices[e].position,a=this.vertices[i].position,o=this.vertices.length;return r[n]=o,this.addVertex((s[0]+a[0])*.5,(s[1]+a[1])*.5,(s[2]+a[2])*.5),o}}class Ft extends it{constructor(){super();const e=Math.sqrt(5)*.5+.5;this.addVertex(-1,e,0,1,e,0,-1,-e,0,1,-e,0,0,-1,e,0,1,e,0,-1,-e,0,1,-e,e,0,-1,e,0,1,-e,0,-1,-e,0,1).addFace(0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1)}}class Dt extends it{constructor(e=1,i=1){super(),this.addVertex(-e/2,-i/2,0),this.addVertex(e/2,-i/2,0),this.addVertex(e/2,i/2,0),this.addVertex(-e/2,i/2,0),this.vertices[0].uv=j(0,0),this.vertices[1].uv=j(1,0),this.vertices[2].uv=j(1,1),this.vertices[3].uv=j(0,1),this.addFace(0,1,2),this.addFace(0,2,3)}}function Ut(t,e,i){const r=t.createShader(e);return r?(t.shaderSource(r,i),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.error(t.getShaderInfoLog(r)),t.deleteShader(r),null)):null}function zt(t,e,i,r){const n=t.createProgram();if(!n)return null;if([t.VERTEX_SHADER,t.FRAGMENT_SHADER].forEach((a,o)=>{const c=Ut(t,a,e[o]);c&&t.attachShader(n,c)}),r)for(const a in r)Object.prototype.hasOwnProperty.call(r,a)&&t.bindAttribLocation(n,r[a],a);return t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)?n:(console.error(t.getProgramInfoLog(n)),t.deleteProgram(n),null)}function Vt(t,e,i){const r=t.createVertexArray();if(!r)return null;t.bindVertexArray(r);for(const[n,s,a]of e)s!==-1&&(t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(s),t.vertexAttribPointer(s,a,t.FLOAT,!1,0,0));if(i){const n=t.createBuffer();n&&(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW))}return t.bindVertexArray(null),r}function Nt(t){const e=Math.min(2,window.devicePixelRatio||1),i=Math.round(t.clientWidth*e),r=Math.round(t.clientHeight*e),n=t.width!==i||t.height!==r;return n&&(t.width=i,t.height=r),n}function tt(t,e,i){const r=t.createBuffer();if(!r)throw new Error("Failed to create WebGL buffer.");return t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,e,i),t.bindBuffer(t.ARRAY_BUFFER,null),r}function Lt(t,e,i,r,n){const s=t.createTexture();if(!s)throw new Error("Failed to create WebGL texture.");return t.bindTexture(t.TEXTURE_2D,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i),s}class Ct{canvas;updateCallback;isPointerDown=!1;orientation=y();pointerRotation=y();rotationVelocity=0;rotationAxis=w(1,0,0);snapDirection=w(0,0,-1);snapTargetDirection=null;pointerPos=S();previousPointerPos=S();_rotationVelocity=0;_combinedQuat=y();EPSILON=.1;IDENTITY_QUAT=y();constructor(e,i){this.canvas=e,this.updateCallback=i||(()=>{}),e.addEventListener("pointerdown",r=>{$(this.pointerPos,r.clientX,r.clientY),J(this.previousPointerPos,this.pointerPos),this.isPointerDown=!0}),e.addEventListener("pointerup",()=>{this.isPointerDown=!1}),e.addEventListener("pointerleave",()=>{this.isPointerDown=!1}),e.addEventListener("pointermove",r=>{this.isPointerDown&&$(this.pointerPos,r.clientX,r.clientY)}),e.style.touchAction="none"}update(e,i=16){const r=e/i+1e-5;let n=r;const s=y();if(this.isPointerDown){const d=.3*r,m=5/r,v=_t(S(),this.pointerPos,this.previousPointerPos);if(It(v,v,d),yt(v)>this.EPSILON){Tt(v,this.previousPointerPos,v);const u=this.project(v),x=this.project(this.previousPointerPos),T=F(g(),u),I=F(g(),x);J(this.previousPointerPos,v),n*=m,this.quatFromVectors(T,I,this.pointerRotation,n)}else D(this.pointerRotation,this.pointerRotation,this.IDENTITY_QUAT,d)}else{const d=.1*r;if(D(this.pointerRotation,this.pointerRotation,this.IDENTITY_QUAT,d),this.snapTargetDirection){const v=this.snapTargetDirection,u=this.snapDirection,x=vt(v,u),T=Math.max(.1,1-x*10);n*=.2*T,this.quatFromVectors(v,u,s,n)}}const a=Z(y(),s,this.pointerRotation);this.orientation=Z(y(),a,this.orientation),q(this.orientation,this.orientation);const o=.8*r;D(this._combinedQuat,this._combinedQuat,a,o),q(this._combinedQuat,this._combinedQuat);const c=Math.acos(this._combinedQuat[3])*2,h=Math.sin(c/2);let l=0;h>1e-6&&(l=c/(2*Math.PI),this.rotationAxis[0]=this._combinedQuat[0]/h,this.rotationAxis[1]=this._combinedQuat[1]/h,this.rotationAxis[2]=this._combinedQuat[2]/h);const f=.5*r;this._rotationVelocity+=(l-this._rotationVelocity)*f,this.rotationVelocity=this._rotationVelocity/r,this.updateCallback(e)}quatFromVectors(e,i,r,n=1){const s=W(g(),e,i);F(s,s);const a=Math.max(-1,Math.min(1,k(e,i))),o=Math.acos(a)*n;return et(r,s,o),{q:r,axis:s,angle:o}}project(e){const r=this.canvas.clientWidth,n=this.canvas.clientHeight,s=Math.max(r,n)-1,a=(2*e[0]-r-1)/s,o=(2*e[1]-n-1)/s;let c=0;const h=a*a+o*o,l=2*2;return h<=l/2?c=Math.sqrt(l-h):c=l/Math.sqrt(h),w(-a,o,c)}}class Bt{constructor(e,i,r,n,s,a=1){this.canvas=e,this.items=i,this.onActiveItemChange=r,this.onMovementChange=n,this.scaleFactor=a,this.camera.position[2]=3*a,this.init(s)}gl=null;discProgram=null;discVAO=null;discBuffers;icoGeo;discGeo;worldMatrix=_();tex=null;control;discLocations;viewportSize=S();drawBufferSize=S();discInstances;instancePositions=[];DISC_INSTANCE_COUNT=0;atlasSize=1;_time=0;_deltaTime=0;_deltaFrames=0;_frames=0;movementActive=!1;TARGET_FRAME_DURATION=1e3/60;SPHERE_RADIUS=2;camera={matrix:_(),near:.1,far:40,fov:Math.PI/4,aspect:1,position:w(0,0,3),up:w(0,1,0),matrices:{view:_(),projection:_(),inversProjection:_()}};smoothRotationVelocity=0;scaleFactor=1;resize(){const e=Nt(this.canvas);this.gl&&(e&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.updateProjectionMatrix())}run(e=0){this._deltaTime=Math.min(32,e-this._time),this._time=e,this._deltaFrames=this._deltaTime/this.TARGET_FRAME_DURATION,this._frames+=this._deltaFrames,this.animate(this._deltaTime),this.render(),requestAnimationFrame(i=>this.run(i))}init(e){const i=this.canvas.getContext("webgl2",{antialias:!0,alpha:!0});if(!i)throw new Error("No WebGL 2 context!");this.gl=i,$(this.viewportSize,this.canvas.clientWidth,this.canvas.clientHeight),Et(this.drawBufferSize),this.discProgram=zt(i,[bt,wt],null,{aModelPosition:0,aModelNormal:1,aModelUvs:2,aInstanceMatrix:3}),this.discLocations={aModelPosition:i.getAttribLocation(this.discProgram,"aModelPosition"),aModelUvs:i.getAttribLocation(this.discProgram,"aModelUvs"),aInstanceMatrix:i.getAttribLocation(this.discProgram,"aInstanceMatrix"),uWorldMatrix:i.getUniformLocation(this.discProgram,"uWorldMatrix"),uViewMatrix:i.getUniformLocation(this.discProgram,"uViewMatrix"),uProjectionMatrix:i.getUniformLocation(this.discProgram,"uProjectionMatrix"),uCameraPosition:i.getUniformLocation(this.discProgram,"uCameraPosition"),uScaleFactor:i.getUniformLocation(this.discProgram,"uScaleFactor"),uRotationAxisVelocity:i.getUniformLocation(this.discProgram,"uRotationAxisVelocity"),uTex:i.getUniformLocation(this.discProgram,"uTex"),uFrames:i.getUniformLocation(this.discProgram,"uFrames"),uItemCount:i.getUniformLocation(this.discProgram,"uItemCount"),uAtlasSize:i.getUniformLocation(this.discProgram,"uAtlasSize")};const r=2.3,n=r+.3;this.discGeo=new Dt(r,n),this.discBuffers=this.discGeo.data,this.discVAO=Vt(i,[[tt(i,this.discBuffers.vertices,i.STATIC_DRAW),this.discLocations.aModelPosition,3],[tt(i,this.discBuffers.uvs,i.STATIC_DRAW),this.discLocations.aModelUvs,2]],this.discBuffers.indices),this.icoGeo=new Ft,this.icoGeo.subdivide(1).spherize(this.SPHERE_RADIUS),this.instancePositions=this.icoGeo.vertices.map(s=>s.position),this.DISC_INSTANCE_COUNT=this.icoGeo.vertices.length,this.initDiscInstances(this.DISC_INSTANCE_COUNT),this.initTexture(),this.control=new Ct(this.canvas,s=>this.onControlUpdate(s)),this.updateCameraMatrix(),this.updateProjectionMatrix(),this.resize(),e&&e(this)}initTexture(){if(!this.gl)return;const e=this.gl;this.tex=Lt(e,e.LINEAR,e.LINEAR,e.CLAMP_TO_EDGE,e.CLAMP_TO_EDGE);const i=Math.max(1,this.items.length);this.atlasSize=Math.ceil(Math.sqrt(i));const r=512,n=document.createElement("canvas"),s=n.getContext("2d");n.width=this.atlasSize*r,n.height=this.atlasSize*r,Promise.all(this.items.map(a=>new Promise(o=>{const c=new Image;c.crossOrigin="anonymous",c.onload=()=>o(c),c.src=a.image}))).then(a=>{a.forEach((o,c)=>{const h=c%this.atlasSize*r,l=Math.floor(c/this.atlasSize)*r,f=o.width/o.height;let d=r,m=r,v=0,u=0;f>1?(m=r/f,u=(r-m)/2):(d=r*f,v=(r-d)/2),s.drawImage(o,h+v,l+u,d,m)}),e.bindTexture(e.TEXTURE_2D,this.tex),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.generateMipmap(e.TEXTURE_2D)})}initDiscInstances(e){if(!this.gl||!this.discVAO)return;const i=this.gl,r=new Float32Array(e*16),n=[];for(let o=0;o<e;++o){const c=new Float32Array(r.buffer,o*16*4,16);ct(c),n.push(c)}this.discInstances={matricesArray:r,matrices:n,buffer:i.createBuffer()},i.bindVertexArray(this.discVAO),i.bindBuffer(i.ARRAY_BUFFER,this.discInstances.buffer),i.bufferData(i.ARRAY_BUFFER,this.discInstances.matricesArray.byteLength,i.DYNAMIC_DRAW);const s=4,a=16*4;for(let o=0;o<s;++o){const c=this.discLocations.aInstanceMatrix+o;i.enableVertexAttribArray(c),i.vertexAttribPointer(c,4,i.FLOAT,!1,a,o*4*4),i.vertexAttribDivisor(c,1)}i.bindBuffer(i.ARRAY_BUFFER,null),i.bindVertexArray(null)}animate(e){if(!this.gl)return;this.control.update(e,this.TARGET_FRAME_DURATION);const i=this.instancePositions.map(s=>X(g(),s,this.control.orientation)),r=.25,n=.6;i.forEach((s,a)=>{const c=(Math.abs(s[2])/this.SPHERE_RADIUS*n+(1-n))*r,h=_();G(h,h,Q(_(),ut(g(),s))),G(h,h,K(_(),[0,0,0],s,[0,1,0])),G(h,h,ht(_(),[c,c,c])),G(h,h,Q(_(),[0,0,-this.SPHERE_RADIUS])),ot(this.discInstances.matrices[a],h)}),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.discInstances.buffer),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,this.discInstances.matricesArray),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.smoothRotationVelocity=this.control.rotationVelocity}render(){if(!this.gl||!this.discProgram)return;const e=this.gl;e.useProgram(this.discProgram),e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.uniformMatrix4fv(this.discLocations.uWorldMatrix,!1,this.worldMatrix),e.uniformMatrix4fv(this.discLocations.uViewMatrix,!1,this.camera.matrices.view),e.uniformMatrix4fv(this.discLocations.uProjectionMatrix,!1,this.camera.matrices.projection),e.uniform3f(this.discLocations.uCameraPosition,this.camera.position[0],this.camera.position[1],this.camera.position[2]),e.uniform4f(this.discLocations.uRotationAxisVelocity,this.control.rotationAxis[0],this.control.rotationAxis[1],this.control.rotationAxis[2],this.smoothRotationVelocity*1.1),e.uniform1i(this.discLocations.uItemCount,this.items.length),e.uniform1i(this.discLocations.uAtlasSize,this.atlasSize),e.uniform1f(this.discLocations.uFrames,this._frames),e.uniform1f(this.discLocations.uScaleFactor,this.scaleFactor),e.uniform1i(this.discLocations.uTex,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.tex),e.bindVertexArray(this.discVAO),e.drawElementsInstanced(e.TRIANGLES,this.discBuffers.indices.length,e.UNSIGNED_SHORT,0,this.DISC_INSTANCE_COUNT),e.bindVertexArray(null)}updateCameraMatrix(){K(this.camera.matrix,this.camera.position,[0,0,0],this.camera.up),H(this.camera.matrices.view,this.camera.matrix)}updateProjectionMatrix(){if(!this.gl)return;const e=this.gl.canvas;this.camera.aspect=e.clientWidth/e.clientHeight;const i=this.SPHERE_RADIUS*.35,r=this.camera.position[2];this.camera.aspect>1?this.camera.fov=2*Math.atan(i/r):this.camera.fov=2*Math.atan(i/this.camera.aspect/r),ft(this.camera.matrices.projection,this.camera.fov,this.camera.aspect,this.camera.near,this.camera.far),H(this.camera.matrices.inversProjection,this.camera.matrices.projection)}onControlUpdate(e){const i=e/this.TARGET_FRAME_DURATION+1e-4;let r=5/i,n=3*this.scaleFactor;const s=this.control.isPointerDown||Math.abs(this.smoothRotationVelocity)>.01;if(s!==this.movementActive&&(this.movementActive=s,this.onMovementChange(s)),this.control.isPointerDown)n+=this.control.rotationVelocity*80+2.5,r=7/i;else{const a=this.findNearestVertexIndex(),o=a%Math.max(1,this.items.length);this.onActiveItemChange(o);const c=F(g(),this.getVertexWorldPosition(a));this.control.snapTargetDirection=c}this.camera.position[2]+=(n-this.camera.position[2])/r,this.updateCameraMatrix()}findNearestVertexIndex(){const e=this.control.snapDirection,i=Pt(y(),this.control.orientation),r=X(g(),e,i);let n=-1,s=0;for(let a=0;a<this.instancePositions.length;++a){const o=k(r,this.instancePositions[a]);o>n&&(n=o,s=a)}return s}getVertexWorldPosition(e){const i=this.instancePositions[e];return X(g(),i,this.control.orientation)}}const Ot=[{image:"https://picsum.photos/900/900?grayscale",link:"https://google.com/",title:"",description:""}],Yt=({items:t=[],scale:e=1})=>{const i=Y.useRef(null),[r,n]=Y.useState(null),[s,a]=Y.useState(!1);Y.useEffect(()=>{const c=i.current;let h=null;const l=d=>{if(!t.length)return;const m=d%t.length;n(t[m])};c&&(h=new Bt(c,t.length?t:Ot,l,a,d=>d.run(),e));const f=()=>{h&&h.resize()};return window.addEventListener("resize",f),f(),()=>{window.removeEventListener("resize",f)}},[t,e]);const o=()=>{r?.link&&(r.link.startsWith("http")?window.open(r.link,"_blank"):console.log("Internal route:",r.link))};return b.jsxs("div",{className:"relative w-full h-screen z-10 bg-transparent",children:[b.jsx("canvas",{id:"infinite-grid-menu-canvas",ref:i,className:"w-full h-full cursor-grab active:cursor-grabbing outline-none bg-transparent am-super-canvas"}),r&&b.jsxs(b.Fragment,{children:[b.jsx("h2",{className:`
            absolute left-[6vmax] top-1/2 -translate-y-1/2 translate-x-1/5 font-extrabold select-none text-[3vmax] 
            text-white dark:text-white/90
            transition-all duration-500 ease-[cubic-bezier(0.25,0.1,0.25,1)]
            am-title-of-card
            ${s?"opacity-0 pointer-events-none duration-100":"opacity-100 pointer-events-auto"}
          `,children:r.title}),b.jsx("p",{className:`
            absolute top-1/2 right-6 -translate-y-1/2 max-w-[12ch] text-[1.5vmax] 
            text-white/80 dark:text-white/70 select-none text-wrap 
            transition-all duration-500 ease-[cubic-bezier(0.25,0.1,0.25,1)]
            am-paragraph-of-card
            ${s?"opacity-0 pointer-events-none translate-x-[-60%] duration-100":"opacity-100 translate-x-[-90%]"}
          `,children:r.description}),b.jsx("div",{onClick:o,className:`
            absolute left-1/2 -translate-x-1/2 text-[1.5vmax] z-10 w-[4vmax] h-[4vmax] grid place-items-center
            bg-[#2b69ed] border-[0.2vmax] border-black rounded-full cursor-pointer
            transition-transform duration-500 ease-[cubic-bezier(0.25,0.1,0.25,1)]
            ${s?"bottom-[-5vmax] opacity-0 pointer-events-none scale-0 duration-100":"bottom-[4vmax] opacity-100 scale-100 hover:scale-110"}
          `,children:b.jsx("span",{className:"text-black text-[1.8vmax] select-none relative",children:"â†—"})})]})]})},qt=()=>b.jsx(Yt,{items:rt.map(({id:t,localImage:e,repo:i,title:r},n)=>({image:nt(e),title:`Project ${n+1}`,link:i,description:r}))});export{qt as ContainerInfiniteMenu};
